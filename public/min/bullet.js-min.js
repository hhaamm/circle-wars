if(typeof window=="undefined"){Explosion=require("./explosion");uuid=require("./uuid")}var MAX_RANDOM_NUMBERS=100;var Bullet=function(a,c,b){this.x=a;this.y=c;this.direction=b;this.type="bullet";this.radius=5;this.bounceChance=1;this.speed=4;this.damage=10;this.randomNumbers=null;this.bulletTypeIndex=0;this.process=function(){this.x+=Math.cos(this.direction)*this.speed;this.y+=-Math.sin(this.direction)*this.speed;var d=this;for(var f=0;f<this.game.entities.length;f++){var e=this.game.entities[f];if(e.type=="player"){var h=d.x-e.x;var g=d.y-e.y;var j=Math.sqrt(h*h+g*g);if(j<d.radius+e.radius){d.onEntityHit(e);d.game.removeEntity(d);d.fragCallback()}}if(e.type=="wall"){if(d.hitTest(e)){d.onEntityHit(e);if(d.randomNumbers&&d.randomNumbers.length){if(e.bounceChance*d.bounceChance>d.randomNumbers.pop()){debug("Bounce");if(d.randomNumbers&&d.randomNumbers.length){d.direction=d.randomNumbers.pop()*Math.PI*2;console.log(d.randomNumbers.length);console.log(d.randomNumbers[d.randomNumbers.length-1]);console.log(b);d.damage=Math.ceil(d.damage*Math.random())}else{d.direction=Math.random()*Math.PI*2;d.damage=Math.ceil(d.damage*d.randomNumbers.pop())}}else{d.game.removeEntity(d);d.fragCallback()}}else{d.game.removeEntity(d);d.fragCallback()}}}if(e.type=="weapon"){if(d.hitTest(e)){d.onEntityHit(e);this.game.removeEntity(this)}}}if(this.aceleration){this.speed+=this.aceleration}if(this.x<0||this.x>this.game.WIDTH||this.y<0||this.y>this.game.HEIGHT){d.game.removeEntity(d)}};this.draw=function(d){d.fillStyle="#00ff00";d.beginPath();d.arc(this.x,this.y,this.radius,0,Math.PI*2,true);d.closePath();d.fill()};this.getDamage=function(){return this.damage};this.onEntityHit=function(d){if(this.game.isClient){return}if(d.type=="weapon"){this.game.trigger("entity hit",d);this.game.removeEntity(d);this.game.triggerServer("entity hit",{id:d.id,type:d.type});this.game.triggerServer("entity hit",{id:this.id,type:this.type});return}var e=this.getDamage();if(this.game.isServer){console.log("entity hit");d.hit(e);console.log({id:d.id,type:d.type,damage:e,life:d.life});this.game.triggerServer("entity hit",{damage:e,life:d.life,id:d.id,type:d.type})}};this.fragCallback=function(){};this.generateRandomNumbers=function(){this.randomNumbers=[];for(var d=0;d<MAX_RANDOM_NUMBERS;d++){this.randomNumbers.push(Math.random())}}};Bullet.prototype=new Entity();var FragmentationBullet=function(a,d,c,b){this.x=a;this.y=d;this.direction=c;this.frags=b;this.divide=5;this.fragCallback=function(){debug("Fragcallback");if(this.frags>0){for(var e=0;e<this.divide;e++){debug("adding new frag bullets");this.game.addEntity(new FragmentationBullet(this.x,this.y,((this.randomNumbers&&this.randomNumbers.length)?this.randomNumbers.pop():Math.random())*Math.PI*2,this.frags-1))}}}};FragmentationBullet.prototype=new Bullet(0,0,0);var Missile=function(a,c,b){this.x=a;this.y=c;this.direction=b;this.type="bullet";this.radius=10;this.bounceChance=0.2;this.speed=2;this.damage=50;this.aceleration=0.1;this.bulletTypeIndex=2;this.onEntityHit=function(d){if(this.game.isClient){return}if(d.type=="weapon"){this.game.removeEntity(d)}if(d.type=="wall"){d.hit(this.getDamage());this.game.triggerServer("entity hit",{id:d.id,life:d.life})}this.game.addEntity(new Explosion(this.x,this.y,this.getDamage(),60,5,uuid.v1()));this.game.triggerServer("new explosion",{x:this.x,y:this.y,damage:this.getDamage(),maxRadius:60,increase:5})}};Missile.prototype=new Bullet(0,0,0);var bulletTypes=[Bullet,FragmentationBullet,Missile];if(typeof window=="undefined"){module.exports.Missile=Missile;module.exports.Bullet=Bullet;module.exports.FragmentationBullet=FragmentationBullet;module.exports.bulletTypes=bulletTypes};