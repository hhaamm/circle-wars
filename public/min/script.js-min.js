(function(){var d=function(){var g={};g.minWalls=parseInt($("#createGameForm [name='minWalls']").val());g.maxWalls=parseInt($("#createGameForm [name='maxWalls']").val());g.weaponGeneration=parseFloat($("#createGameForm [name='weaponGeneration']").val());console.log(g);var e=$("#canvas")[0].getContext("2d");var f=new Game(e,$("#canvas").attr("width"),$("#canvas").attr("height"),g);f.init();f.onGameOver=function(){$("#gameEndMenu").show();delete f}};var c=function(){var g=io.connect(serverUrl,{transports:["websocket"]});var j={};j.minWalls=10;j.maxWalls=200;j.weaponGeneration=0.9999;j.multiplayer="client";var f=$("#canvas")[0].getContext("2d");$($("#canvas")[0]).attr("width","800px");$($("#canvas")[0]).attr("height","600px");var h=new Game(f,800,600,j);h.socket=g;var e={left:37,right:39,forward:38,backward:40,shoot:13};var i=new Player(100,100,1,"Player 1",e);$(document).keydown(function(k){i.onKeyDown(k);g.emit("move player",{id:i.id,position:{x:i.getX(),y:i.getY()}});return false});$(document).keyup(function(k){i.onKeyUp(k);return false});h.initClient(i);h.onGameOver=function(){h.stop();window.location.href="/over"};g.on("state",function(n){if(!n.id){throw"No id provided from server"}console.log("State");console.log(n.opts);console.log(n.players);console.log("Your session id is "+n.id);console.log("players: "+h.players.length);i.id=n.id;for(var m=0;m<n.players.length;m++){var l=new Player(n.players[m].x,n.players[m].y,0,n.players[m].name,1);l.id=n.players[m].id;if(!n.players[m].id){throw"Error: player without ID"}if(i.id!=l.id){console.log("adding player "+l.id);console.log(l.id);h.addPlayerIfNotPresent(l)}}console.log("players"+h.players.length);console.log("weapons");console.log(n.weapons);for(m=0;m<n.weapons.length;m++){var k=n.weapons[m];console.log(k.weaponTypeIndex);h.addWeapon(k.weaponTypeIndex,k.position.x,k.position.y,k.id)}console.log(n.walls);for(m=0;m<n.walls.length;m++){h.addEntity(new Wall(n.walls[m].x,n.walls[m].y,n.walls[m].material,n.walls[m].id))}console.log("Send new player: "+i.id);g.emit("new player",{x:i.getX(),y:i.getY(),name:"Player"})});g.on("connect",function(){console.log("Connected")});g.on("disconnect",function(k){console.log(k)});g.on("new player",function(k){console.log("New player arrived");console.log(k);var l=new Player(k.x,k.y,k.direction,k.name);l.id=k.id;if(!k.id){console.log("WARNING: Receiving player without ID from server");return}if(k.id==h.player1.id){console.log("WARNING: Receiving player with same id as player1 from server");return}console.log(l);h.addPlayerIfNotPresent(l)});g.on("move player",function(l){var k=h.getPlayer(l.playerId);if(!k){console.log("WARNING: no player with ID "+l.playerId);return}k.x=l.position.x;k.y=l.position.y});g.on("remove player",function(k){console.log("removing player "+k.playerId);h.removePlayer(k.playerId)});g.on("new weapon",function(k){console.log("New weapon arrived from the server: "+k.x+" "+k.y);h.addWeapon(k.weaponTypeIndex,k.position.x,k.position.y,k.id)});g.on("weapon taken",function(m){console.log("Weapon taken: "+m.id);var l=h.getEntityById(m.id);h.removeEntity(l);console.log(l);var k=h.getPlayer(m.playerId);k.addWeapon(l)});g.on("new bullet",function(n){var l=new Vector(n.direction,n.outsideSuicideZone);l.originX=n.position.x;l.originY=n.position.y;console.log(n);var m=bulletTypes[n.bulletTypeIndex];var k=new m(l.x(),l.y(),n.direction,false);k.id=n.id;k.randomNumbers=n.randomNumbers;console.log(k);console.log("new bullet");h.addEntity(k,false)});g.on("entity hit",function(l){console.log("entity hit");var k=h.getEntityById(l.id);if(!k){console.log("Not existing entity with id = "+l.id);return}console.log(l);console.log(k);if(k.type=="weapon"||k.type=="bullet"){h.removeEntity(k);return}if(l.life<=0){if(k.type=="wall"){h.removeEntity(k)}if(k.type=="player"){if(k.id==h.player1.id){h.onGameOver()}else{h.removeEntity(k)}}}else{k.life=l.life}})};var b=function(){$("#newGameBtn").click(function(){a("CreateGame");return false});$("#newMultiplayerGameBtn").click(function(){a("Game");c();return false});$("#startGameBtn").click(function(){a("Game");d();return false});$("#newGame2Btn").click(function(){$("#gameEndMenu").hide();console.log("restart");a("CreateGame");return false});$("#restartGameBtn").click(function(){$("#gameEndMenu").hide();console.log("restart");a("Game");d();return false});$("#exitBtn").click(function(){$("#gameEndMenu").hide();a("Init");return false})};var a=function(e){$(".stage").hide();$("#stage"+e).show()};$(document).ready(function(){b();a("Init")})})();